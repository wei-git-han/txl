<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>通讯录-单点登录</title>
<script src="assets/global/plugins/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
console.log(window);
$(function () {
	//$("#servicePath").val(window.location.origin + "/index.html");
});

function login()
{
$.ajax({
        url: $("#urlPath").val() + "/api/sso/authen/",
        data: {username: $("#usename").val(), password: $("#password").val(), loginMode:"100",service:$("#servicePath").val()},
        type: 'POST',
        dataType: "JSON",
        success: function(data){
            // get access_token
			//alert(data.access_token);
			$('#token').text(data.access_token);
        },
        error: function(error){
            // show error
            var a = error;
            
        }
    });
}

function loginApplication(){
$.ajax({
        url: $("#urlPath").val() + "/api/sso/authen/",
        data: {username: $("#usename").val(), password: $("#password").val(), loginMode:"100",service:$("#servicePath").val()},
        type: 'POST',
        dataType: "JSON",
        success: function(data){
            window.location.href = $("#servicePath").val() + "?access_token=" +data.access_token;
        },
        error: function(error){
            // show error
            var a = error;
            
        }
    });
}

function validate(){
    	var url1 = $("#urlPath").val() + "/api/sso/valtoken/"+$('#token').text();
    $.ajax({
        url: url1,
                type: 'POST',
        dataType: "JSON",
        success: function(data){
            // get access_token
            $('#valtxt').text(JSON.stringify( data ));
        },
        error: function(error){
            // show error
            var a = error;
            
        }
    });
   }

   
function getUser(){
    $.ajax({
        url: $("#urlPath").val() + "/api/sso/user/",
        data: {access_token: $('#token').text()},
        type: 'POST',
        dataType: "JSON",
        success: function(data){
            // get access_token
            $('#usertxt').text(JSON.stringify( data ));
        },
        error: function(error){
            // show error
            var a = error;
            
        }
    });
   }

function logout(){
    	var url1 = $("#urlPath").val() + "/api/sso/logout/"+$('#token').text();
    $.ajax({
        url: url1,
                type: 'POST',
        dataType: "JSON",
        success: function(data){
            // get access_token
            $('#valtxt').text(JSON.stringify( data ));
        },
        error: function(error){
            // show error
            var a = error;
        }
    });
   }
   
function authen(){
    	var url1 = $("#urlPath").val() + "/api/sso/authen/"+$('#token').text();
    $.ajax({
        url: url1,
        type: 'POST',
        dataType: "JSON",
        success: function(data){
            // get access_token
            $('#valtxt').text(JSON.stringify( data ));
			alert(data);
        },
        error: function(error){
            // show error
            var a = error;
            
        }
    });
   }
</script>
</head>
<body>
用户名:<input type="text" value="admin" id="usename"/>
密码:<input type="text" value="8"id="password"/><br/>
网关地址:<input type="text" value="http://172.16.3.4:8765" id="urlPath" style="width:325px;"/><br/>
应用主页:<input type="text" value="index.html" id="servicePath" style="width:325px;"/>
<div><label>Token: </label><label id="token"></label></div>
<div><label>返回结果: </label><label id="valtxt"></label></div>
<div><label>用户信息: </label><label id="usertxt"></label></div>
<button type="button" onclick="login()">获取Token</button>
<button type="button" onclick="validate()">验证Token</button>
<button type="button" onclick="getUser()">获取用户信息</button>
<button type="button" onclick="logout()">注销Token</button>
<button type="button" onclick="loginApplication()">登录应用</button>
<!--<button type="button" onclick="authen()">延长Token有效期</button>-->

</body>
</html>